# Viveo - Calorie Tracking Application

A comprehensive nutrition tracking application with AI-powered food logging and analysis.

## ğŸ—ï¸ Architecture

- **Backend**: FastAPI (Python 3.13) with MySQL database
- **Frontend**: Static HTML/CSS/JavaScript served by nginx
- **AI**: Claude 3.5 Haiku for nutrition analysis
- **Deployment**: Docker Compose with nginx reverse proxy
- **Storage**: MySQL for user data, local files for vector store

## ğŸ“‹ Prerequisites

- Docker and Docker Compose
- Proxmox server or any Linux server
- Claude API key from Anthropic
- At least 2GB available disk space
- Ports 80, 443, 3000, 8000, 3306 available

## ğŸš€ Quick Deployment

### 1. Clone and Setup

```bash
# Create project directory
mkdir viveo-app && cd viveo-app

# Download deployment files (or clone your repository)
# Place all the provided files in this directory
```

### 2. Directory Structure

Your project should have this structure (matching your current layout):

```
viveo-app/
â”œâ”€â”€ app/                          # Backend application (your structure)
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ ask_ai.py
â”‚   â”‚       â”œâ”€â”€ auth.py
â”‚   â”‚       â”œâ”€â”€ food_log.py
â”‚   â”‚       â””â”€â”€ profile.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ai_client.py
â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â”œâ”€â”€ utils.py
â”‚   â”‚   â””â”€â”€ vector_store.py
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”œâ”€â”€ schemas.py
â”‚   â”‚   â””â”€â”€ session.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ food_processor.py
â”‚   â”‚   â””â”€â”€ rag_service.py
â”‚   â”œâ”€â”€ main.py                   # Your FastAPI app (in app/ directory)
â”‚   â”œâ”€â”€ config.py                 # Your config (in app/ directory)
â”‚   â””â”€â”€ settings.py               # Your settings (in app/ directory)
â”œâ”€â”€ frontend/                     # Frontend files
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ config.js
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ foodLog.js
â”‚   â”œâ”€â”€ profile.js
â”‚   â”œâ”€â”€ calendar.js
â”‚   â”œâ”€â”€ app.js
â”‚   â”œâ”€â”€ aiChat.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ data/                         # Application data (your vector store)
â”‚   â”œâ”€â”€ users/
â”‚   â””â”€â”€ vectors/
â”œâ”€â”€ nginx/                        # Nginx configuration
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â””â”€â”€ ssl/
â”œâ”€â”€ mysql/                        # MySQL initialization
â”‚   â””â”€â”€ init/
â”‚       â””â”€â”€ 01-init.sql
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile.backend
â”œâ”€â”€ .env.example
â”œâ”€â”€ deploy.sh
â”œâ”€â”€ requirements.txt              # Your Python dependencies
â””â”€â”€ README.md
```

### 3. Configuration

```bash
# Make deploy script executable
chmod +x deploy.sh

# Copy environment template
cp .env.example .env

# Edit environment variables
nano .env
```

**Required environment variables:**
```bash
# Add your Claude API key
CLAUDE_API_KEY=sk-ant-your-api-key-here

# Database passwords (auto-generated by deploy script)
MYSQL_ROOT_PASSWORD=your-generated-password
MYSQL_PASSWORD=your-generated-password

# JWT secret (auto-generated by deploy script)
SECRET_KEY=your-generated-secret-key
```

### 4. Deploy

```bash
# Run deployment script
./deploy.sh

# Or with SSL support
./deploy.sh --ssl
```

### 5. Access Application

- **Frontend**: http://your-server-ip
- **API**: http://your-server-ip/api
- **Health Check**: http://your-server-ip/api/health

## ğŸ”§ Manual Deployment Steps

If you prefer manual deployment:

### 1. Setup Environment

```bash
# Create directories
mkdir -p data/{users,vectors} logs nginx/ssl mysql/init frontend

# Copy environment file
cp .env.example .env

# Edit with your settings
nano .env
```

### 2. Build and Start Services

```bash
# Build images
docker-compose build

# Start services
docker-compose up -d

# Check status
docker-compose ps
```

### 3. Verify Deployment

```bash
# Check logs
docker-compose logs -f backend
docker-compose logs -f frontend

# Test API
curl http://localhost/api/health

# Test frontend
curl http://localhost
```

## ğŸ“Š Management Commands

### Service Management

```bash
# View logs
docker-compose logs -f [service-name]

# Restart service
docker-compose restart [service-name]

# Stop all services
docker-compose down

# Update application
./deploy.sh --update

# Check service health
./deploy.sh --health
```

### Backup and Restore

```bash
# Create backup
./backup.sh

# Setup automated backups (add to crontab)
crontab -e
# Add: 0 2 * * * /path/to/viveo/backup.sh

# Restore from backup
docker exec -i viveo-mysql mysql -u root -p viveo_db < backup_file.sql
```

### Monitoring

```bash
# Check resource usage
docker stats

# View disk usage
df -h

# Clean up old data
./deploy.sh --cleanup

# Monitor logs in real-time
tail -f logs/*.log
```

## ğŸ”’ Security Considerations

### Production Setup

1. **Change Default Passwords**
   ```bash
   # Generate secure passwords
   openssl rand -hex 32
   ```

2. **Setup SSL Certificates**
   ```bash
   # Use Let's Encrypt for free SSL
   certbot --nginx -d yourdomain.com
   ```

3. **Configure Firewall**
   ```bash
   # Allow only necessary ports
   ufw allow 80
   ufw allow 443
   ufw deny 3000
   ufw deny 8000
   ufw deny 3306
   ```

4. **Secure Database**
   ```bash
   # Run MySQL security script
   docker exec -it viveo-mysql mysql_secure_installation
   ```

### Environment Variables

Ensure these are set securely:

```bash
# Strong JWT secret (64+ characters)
SECRET_KEY=your-very-long-random-secret-key

# Secure database passwords
MYSQL_ROOT_PASSWORD=strong-password
MYSQL_PASSWORD=another-strong-password

# Production settings
ENVIRONMENT=production
DEBUG=false
```

## ğŸ› Troubleshooting

### Common Issues

1. **Service won't start**
   ```bash
   # Check logs
   docker-compose logs [service-name]
   
   # Check resources
   docker system df
   free -h
   ```

2. **Database connection errors**
   ```bash
   # Verify MySQL is running
   docker exec viveo-mysql mysqladmin ping
   
   # Check database exists
   docker exec -it viveo-mysql mysql -u root -p -e "SHOW DATABASES;"
   ```

3. **API returns 500 errors**
   ```bash
   # Check backend logs
   docker-compose logs backend
   
   # Verify environment variables
   docker exec viveo-backend env | grep -E "(DATABASE_URL|CLAUDE_API_KEY)"
   ```

4. **Frontend not loading**
   ```bash
   # Check nginx configuration
   docker exec viveo-nginx nginx -t
   
   # Restart nginx
   docker-compose restart nginx
   ```

### Performance Optimization

1. **Database Optimization**
   ```sql
   -- Add indexes for better performance
   CREATE INDEX idx_food_entries_user_date ON food_entries(user_id, entry_date);
   CREATE INDEX idx_users_active ON users(disabled, last_login);
   ```

2. **Resource Limits**
   ```yaml
   # Add to docker-compose.yml
   services:
     backend:
       deploy:
         resources:
           limits:
             memory: 512M
             cpus: '0.5'
   ```

## ğŸ“ˆ Monitoring and Alerts

### Setup Monitoring

```bash
# Add monitoring to crontab
crontab -e

# Check services every 5 minutes
*/5 * * * * /path/to/viveo/health_check.sh

# Backup daily at 2 AM
0 2 * * * /path/to/viveo/backup.sh

# Cleanup weekly
0 3 * * 0 /path/to/viveo/deploy.sh --cleanup
```

### Log Rotation

```bash
# Setup logrotate
sudo nano /etc/logrotate.d/viveo

# Add configuration
/path/to/viveo/logs/*.log {
    daily
    missingok
    rotate 7
    compress
    notifempty
    copytruncate
}
```

## ğŸ”„ Updates and Maintenance

### Regular Updates

```bash
# Update application
./deploy.sh --update

# Update Docker images
docker-compose pull
docker-compose up -d
```

### Database Maintenance

```bash
# Optimize database
docker exec viveo-mysql mysqlcheck -u root -p --optimize viveo_db

# Backup before major updates
./backup.sh
```

## ğŸ“ Support

For issues or questions:

1. Check the logs: `docker-compose logs -f`
2. Review this README
3. Check environment variables
4. Verify all services are running: `docker-compose ps`

## ğŸ“„ License

This project is licensed under the MIT License.